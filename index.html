<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aplicaci√≥n web para gesti√≥n de presupuesto familiar con categor√≠as, transacciones y reportes detallados">
    <meta name="keywords" content="presupuesto, finanzas, hogar, gastos, ingresos, categor√≠as">
    <meta name="author" content="JM Budget">
    <meta name="robots" content="index, follow">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    
    <title>JM Budget - Gesti√≥n de Presupuesto Familiar</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    
    <!-- Configuraci√≥n de la aplicaci√≥n -->
    <script src="config.js"></script>
</head>
<body>
    <!-- Sistema de Login -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <i class="fas fa-wallet"></i>
                <h1>JM Budget</h1>
                <p>Gesti√≥n de Presupuesto Familiar</p>
            </div>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Usuario:</label>
                    <input type="text" id="username" placeholder="Ingresa tu nombre de usuario" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Contrase√±a:</label>
                    <input type="password" id="password" placeholder="Ingresa tu contrase√±a" required>
                </div>
                
                <div class="login-actions">
                    <button type="button" id="loginBtn" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
                    </button>
                    <button type="button" id="registerBtn" class="btn-secondary">
                        <i class="fas fa-user-plus"></i> Registrarse
                    </button>
                </div>
                
                <div class="login-info">
                    <p><i class="fas fa-info-circle"></i> Los datos se guardan localmente en tu navegador</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenido Principal de la Aplicaci√≥n -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Header con informaci√≥n del usuario -->
        <header class="header">
            <div class="header-content">
                <div class="app-title">
                    <i class="fas fa-wallet"></i>
                    <h1>JM Budget</h1>
                </div>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <div class="notifications-container">
                        <div id="notificationsList" class="notifications-list"></div>
                        <button id="notificationsBtn" class="btn-notifications" title="Notificaciones">
                            <i class="fas fa-bell"></i>
                            <span id="notificationsCount" class="notifications-count">0</span>
                        </button>
                    </div>
                    <div class="user-actions">
                        <div class="menu-container">
                            <button id="menuBtn" class="btn-menu" title="Men√∫ de opciones">
                                <i class="fas fa-bars"></i>
                            </button>
                            <div id="menuDropdown" class="menu-dropdown">
                                <button class="menu-item" id="collaborationBtn" title="Gestionar colaboraci√≥n">
                                    <i class="fas fa-users"></i>
                                    <span>Gestionar Colaboraci√≥n</span>
                                </button>
                                <button class="menu-item" id="importBtn" title="Importar datos">
                                    <i class="fas fa-file-import"></i>
                                    <span>Importar Datos</span>
                                </button>
                                <button class="menu-item" id="backupBtn" title="Crear backup">
                                    <i class="fas fa-download"></i>
                                    <span>Crear Backup</span>
                                </button>
                                <button class="menu-item" id="resetCategoriesBtn" title="Restablecer categor√≠as por defecto">
                                    <i class="fas fa-refresh"></i>
                                    <span>Restablecer Categor√≠as</span>
                                </button>
                                <div class="menu-divider"></div>
                                <button class="menu-item logout-item" id="logoutBtn" title="Cerrar sesi√≥n">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Cerrar Sesi√≥n</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navegaci√≥n por pesta√±as -->
        <nav class="tab-navigation">
            <button class="tab-btn active" data-tab="presupuesto">
                <i class="fas fa-chart-pie"></i> Presupuesto
            </button>
            <button class="tab-btn" data-tab="transacciones">
                <i class="fas fa-exchange-alt"></i> Transacciones
            </button>
            <button class="tab-btn" data-tab="reportes">
                <i class="fas fa-chart-bar"></i> Reportes
            </button>
        </nav>

        <!-- Contenido principal -->
        <main class="main-content">
            <!-- Secci√≥n Presupuesto -->
            <section id="presupuesto" class="tab-content active">
                <div class="section-header">
                    <h2>Presupuesto Mensual</h2>
                    <div class="budget-controls">
                        <div class="month-selector">
                            <label for="budgetMonth">Mes:</label>
                            <select id="budgetMonth" class="month-select">
                                <option value="">Mes actual</option>
                            </select>
                        </div>
                        <div class="budget-actions">
                            <button class="btn-secondary" id="selectCategoryBtn">
                                <i class="fas fa-list"></i> Elegir Categor√≠a
                            </button>
                            <button class="btn-primary" id="addCategoryBtn">
                                <i class="fas fa-plus"></i> Nueva Categor√≠a
                            </button>
                            <button class="btn-primary" id="addIncomeBtn">
                                <i class="fas fa-plus"></i> Nuevo Ingreso
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3 data-icon="budget">Presupuesto Total</h3>
                        <div class="amount" id="totalBudget">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="spent">Gastado</h3>
                        <div class="amount spent" id="totalSpent">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="remaining">Restante</h3>
                        <div class="amount remaining" id="totalRemaining">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="income">Ingresos</h3>
                        <div class="amount income" id="totalIncomes">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="balance">Balance</h3>
                        <div class="amount" id="totalBalance">$0</div>
                    </div>
                </div>
                
                <div id="incomesContainer"></div>
                
                <h3 id="gastosRecurrentesTitle" style="margin-bottom: 20px; color: #333; font-size: 18px; font-weight: 600;">Gastos Recurrentes</h3>
                <div id="categoriesContainer"></div>
            </section>

            <!-- Secci√≥n Transacciones -->
            <section id="transacciones" class="tab-content">
                <div class="section-header">
                    <h2>Transacciones</h2>
                    <button class="btn-primary" id="addTransactionBtn">
                        <i class="fas fa-plus"></i> Nueva Transacci√≥n
                    </button>
                </div>
                
                <div class="filters">
                    <select id="monthFilter">
                        <option value="">Todos los meses</option>
                    </select>
                    <select id="categoryFilter">
                        <option value="">Todas las categor√≠as</option>
                    </select>
                    <select id="typeFilter">
                        <option value="">Todos los tipos</option>
                        <option value="ingreso">Ingresos</option>
                        <option value="gasto">Gastos</option>
                    </select>
                </div>
                
                <div id="transactionsContainer"></div>
            </section>

            <!-- Secci√≥n Reportes -->
            <section id="reportes" class="tab-content">
                <div class="section-header">
                    <h2>Reportes y An√°lisis</h2>
                    <div class="report-controls">
                        <div class="report-filters">
                            <select id="reportMonth">
                                <option value="">Todos los meses</option>
                            </select>
                            <select id="reportType">
                                <option value="overview">Vista General</option>
                                <option value="trends">Tendencias</option>
                                <option value="categories">An√°lisis por Categor√≠a</option>
                                <option value="comparison">Comparaci√≥n Mensual</option>
                            </select>
                            <button id="exportReportBtn" class="btn-secondary">
                                <i class="fas fa-download"></i> Exportar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3 data-icon="income">Ingresos del Mes</h3>
                        <div class="amount income" id="monthlyIncome">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="expense">Gastos del Mes</h3>
                        <div class="amount expense" id="monthlyExpenses">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="balance">Balance</h3>
                        <div class="amount" id="monthlyBalance">$0</div>
                    </div>
                    <div class="summary-card">
                        <h3 data-icon="trend">Tendencia</h3>
                        <div class="amount" id="monthlyTrend">$0</div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Gastos por Categor√≠a</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Evoluci√≥n Mensual</h3>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Tendencia de Gastos</h3>
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>An√°lisis Detallado por Categor√≠a</h3>
                        <canvas id="detailedCategoryChart"></canvas>
                    </div>
                </div>
                
                <div class="report-details">
                    <div class="report-section">
                        <h3>Top 5 Categor√≠as con Mayor Gasto</h3>
                        <div id="topCategoriesList"></div>
                    </div>
                    <div class="report-section">
                        <h3>Comparaci√≥n con Mes Anterior</h3>
                        <div id="monthComparison"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal para Nueva/Editar Categor√≠a -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('categoryModal')">&times;</span>
            <h2 id="categoryModalTitle">Nueva Categor√≠a</h2>
            <form id="categoryForm">
                <div class="form-group">
                    <label for="categoryName">Categor√≠a:</label>
                    <div class="select-with-add">
                        <select id="categoryName" required>
                            <option value="">Selecciona una categor√≠a</option>
                        </select>
                        <button type="button" class="btn-icon" id="addCategoryBtn" title="Agregar nueva categor√≠a">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="categorySubcategory">Subcategor√≠a:</label>
                    <div class="select-with-add">
                        <select id="categorySubcategory" required>
                            <option value="">Selecciona una subcategor√≠a</option>
                        </select>
                        <button type="button" class="btn-icon" id="addSubcategoryBtn" title="Agregar nueva subcategor√≠a">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="categoryBudget">Presupuesto Mensual:</label>
                    <input type="number" id="categoryBudget" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="categoryRecurringFrequency">Frecuencia de Recurrencia:</label>
                    <select id="categoryRecurringFrequency" required>
                        <option value="monthly">Mensual</option>
                        <option value="weekly">Semanal</option>
                        <option value="biweekly">Quincenal (cada 15 d√≠as)</option>
                        <option value="quarterly">Trimestral</option>
                        <option value="semiannual">Semestral</option>
                        <option value="annual">Anual</option>
                        <option value="custom">Personalizada</option>
                    </select>
                </div>
                <div class="form-group" id="recurringDateGroup">
                    <label for="categoryRecurringDate">Fecha de Inicio:</label>
                    <input type="date" id="categoryRecurringDate" required>
                </div>
                <div class="form-group" id="customFrequencyGroup" style="display: none;">
                    <label for="categoryCustomDays">Cada cu√°ntos d√≠as:</label>
                    <input type="number" id="categoryCustomDays" min="1" max="365" placeholder="Ej: 30">
                </div>
                <div class="form-group">
                    <label for="categoryColor">Color:</label>
                    <input type="color" id="categoryColor" value="#007aff">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Guardar</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('categoryModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Nueva/Editar Transacci√≥n -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('transactionModal')">&times;</span>
            <h2 id="transactionModalTitle">Nueva Transacci√≥n</h2>
            <form id="transactionForm">
                <div class="form-group">
                    <label for="transactionDescription">Descripci√≥n:</label>
                    <input type="text" id="transactionDescription" required>
                </div>
                <div class="form-group">
                    <label for="transactionAmount">Monto:</label>
                    <input type="number" id="transactionAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="transactionType">Tipo:</label>
                    <select id="transactionType" required>
                        <option value="gasto">Gasto</option>
                        <option value="ingreso">Ingreso</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transactionCategory">Categor√≠a:</label>
                    <select id="transactionCategory" required>
                        <option value="">Selecciona una categor√≠a</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transactionDate">Fecha:</label>
                    <input type="date" id="transactionDate" required>
                </div>
                <div class="form-group">
                    <label for="transactionComment">Comentario (opcional):</label>
                    <textarea id="transactionComment" placeholder="Agrega un comentario sobre esta transacci√≥n..." rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Guardar</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('transactionModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Seleccionar Categor√≠a Existente -->
    <div id="selectCategoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('selectCategoryModal')">&times;</span>
            <h2>Elegir Categor√≠a Existente</h2>
            <form id="selectCategoryForm">
                <div class="form-group">
                    <label for="selectCategoryName">Categor√≠a:</label>
                    <select id="selectCategoryName" required>
                        <option value="">Selecciona una categor√≠a</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="selectSubcategoryName">Subcategor√≠a:</label>
                    <select id="selectSubcategoryName" required>
                        <option value="">Selecciona una subcategor√≠a</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="selectCategoryBudget">Presupuesto Mensual:</label>
                    <input type="number" id="selectCategoryBudget" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="selectCategoryRecurringFrequency">Frecuencia de Recurrencia:</label>
                    <select id="selectCategoryRecurringFrequency" required>
                        <option value="monthly">Mensual</option>
                        <option value="weekly">Semanal</option>
                        <option value="biweekly">Quincenal (cada 15 d√≠as)</option>
                        <option value="quarterly">Trimestral</option>
                        <option value="semiannual">Semestral</option>
                        <option value="annual">Anual</option>
                        <option value="custom">Personalizada</option>
                    </select>
                </div>
                <div class="form-group" id="selectRecurringDateGroup">
                    <label for="selectCategoryRecurringDate">Fecha de Inicio:</label>
                    <input type="date" id="selectCategoryRecurringDate" required>
                </div>
                <div class="form-group" id="selectCustomFrequencyGroup" style="display: none;">
                    <label for="selectCategoryCustomDays">Cada cu√°ntos d√≠as:</label>
                    <input type="number" id="selectCategoryCustomDays" min="1" max="365" placeholder="Ej: 30">
                </div>
                <div class="form-group">
                    <label for="selectCategoryColor">Color:</label>
                    <input type="color" id="selectCategoryColor" value="#007aff">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Agregar al Presupuesto</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('selectCategoryModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Gesti√≥n de Colaboraci√≥n -->
    <div id="collaborationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('collaborationModal')">&times;</span>
            <h2>Gesti√≥n de Colaboraci√≥n</h2>
            
            <div class="collaboration-tabs">
                <button class="collab-tab-btn active" data-tab="invite">Invitar</button>
                <button class="collab-tab-btn" data-tab="members">Miembros</button>
                <button class="collab-tab-btn" data-tab="requests">Solicitudes</button>
                <button class="collab-tab-btn" data-tab="history">Historial</button>
            </div>
            
            <!-- Pesta√±a Invitar -->
            <div id="invite-tab" class="collab-tab-content active">
                <div class="form-group">
                    <label for="inviteEmail">Email del colaborador:</label>
                    <input type="email" id="inviteEmail" placeholder="ejemplo@email.com" required>
                </div>
                <div class="form-group">
                    <label for="inviteRole">Rol:</label>
                    <select id="inviteRole" required>
                        <option value="collaborator">Colaborador</option>
                        <option value="viewer">Solo lectura</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inviteMessage">Mensaje (opcional):</label>
                    <textarea id="inviteMessage" placeholder="Hola, te invito a colaborar en nuestro presupuesto familiar..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-primary" onclick="sendInvitation()">
                        <i class="fas fa-paper-plane"></i> Enviar Invitaci√≥n
                    </button>
                </div>
            </div>
            
            <!-- Pesta√±a Miembros -->
            <div id="members-tab" class="collab-tab-content">
                <div id="membersList">
                    <p class="no-members">No hay miembros colaborando a√∫n.</p>
                </div>
            </div>
            
            <!-- Pesta√±a Solicitudes -->
            <div id="requests-tab" class="collab-tab-content">
                <div id="requestsList">
                    <p class="no-requests">No hay solicitudes pendientes.</p>
                </div>
            </div>
            
            <!-- Pesta√±a Historial -->
            <div id="history-tab" class="collab-tab-content">
                <div class="history-filters">
                    <select id="historyTypeFilter">
                        <option value="">Todos los cambios</option>
                        <option value="transaction">Transacciones</option>
                        <option value="category">Categor√≠as</option>
                        <option value="collaboration">Colaboraci√≥n</option>
                    </select>
                    <select id="historyUserFilter">
                        <option value="">Todos los usuarios</option>
                    </select>
                </div>
                <div id="historyList">
                    <p class="no-history">No hay cambios registrados a√∫n.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Importaci√≥n -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('importModal')">&times;</span>
            <h2>Importar Datos</h2>
            
            <div class="import-tabs">
                <button class="import-tab-btn active" data-tab="instructions">Instrucciones</button>
                <button class="import-tab-btn" data-tab="upload">Subir Archivo</button>
                <button class="import-tab-btn" data-tab="preview">Vista Previa</button>
            </div>
            
            <!-- Pesta√±a Instrucciones -->
            <div id="instructions-tab" class="import-tab-content active">
                <div class="import-instructions">
                    <h3>üìã Formato Requerido</h3>
                    <p>Tu archivo debe tener las siguientes columnas:</p>
                    <ul>
                        <li><strong>Descripci√≥n</strong>: Nombre de la transacci√≥n</li>
                        <li><strong>Monto</strong>: Cantidad (positivo para ingresos, negativo para gastos)</li>
                        <li><strong>Tipo</strong>: "ingreso" o "gasto"</li>
                        <li><strong>Categor√≠a</strong>: Categor√≠a principal</li>
                        <li><strong>Subcategor√≠a</strong>: Subcategor√≠a (opcional)</li>
                        <li><strong>Fecha</strong>: Fecha en formato YYYY-MM-DD</li>
                        <li><strong>Comentario</strong>: Comentario opcional</li>
                    </ul>
                    
                    <h3>üìä Ejemplo de Datos</h3>
                    <div class="example-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Descripci√≥n</th>
                                    <th>Monto</th>
                                    <th>Tipo</th>
                                    <th>Categor√≠a</th>
                                    <th>Subcategor√≠a</th>
                                    <th>Fecha</th>
                                    <th>Comentario</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Supermercado</td>
                                    <td>-150.50</td>
                                    <td>gasto</td>
                                    <td>Alimentaci√≥n y Bebidas</td>
                                    <td>Supermercado</td>
                                    <td>2024-01-15</td>
                                    <td>Compra semanal</td>
                                </tr>
                                <tr>
                                    <td>Salario</td>
                                    <td>2500.00</td>
                                    <td>ingreso</td>
                                    <td>Ingresos</td>
                                    <td>Salario</td>
                                    <td>2024-01-01</td>
                                    <td>Pago mensual</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>üí° Consejos</h3>
                    <ul>
                        <li>Exporta tu archivo como CSV desde Excel, Numbers o Google Sheets</li>
                        <li>Aseg√∫rate de que las fechas est√©n en formato YYYY-MM-DD</li>
                        <li>Los montos negativos se importar√°n como gastos</li>
                        <li>Las categor√≠as y subcategor√≠as se crear√°n autom√°ticamente si no existen</li>
                    </ul>
                </div>
            </div>
            
            <!-- Pesta√±a Subir Archivo -->
            <div id="upload-tab" class="import-tab-content">
                <div class="upload-area">
                    <div class="file-drop-zone" id="fileDropZone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Arrastra tu archivo aqu√≠</h3>
                        <p>o haz clic para seleccionar</p>
                        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" style="display: none;">
                    </div>
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <div class="file-details">
                            <i class="fas fa-file"></i>
                            <span id="fileName"></span>
                            <span id="fileSize"></span>
                        </div>
                        <button id="processFileBtn" class="btn-primary">
                            <i class="fas fa-cog"></i> Procesar Archivo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Pesta√±a Vista Previa -->
            <div id="preview-tab" class="import-tab-content">
                <div class="preview-controls">
                    <div class="preview-stats">
                        <span id="totalRows">Total: 0 filas</span>
                        <span id="validRows">V√°lidas: 0</span>
                        <span id="invalidRows">Con errores: 0</span>
                    </div>
                    <div class="preview-actions">
                        <button id="importDataBtn" class="btn-primary" disabled>
                            <i class="fas fa-download"></i> Importar Datos
                        </button>
                        <button id="cancelImportBtn" class="btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
                <div class="preview-table">
                    <div id="previewContent">
                        <p class="no-preview">Sube un archivo para ver la vista previa</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo Ingreso Recurrente -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('incomeModal')">&times;</span>
            <h2 id="incomeModalTitle">Nuevo Ingreso Recurrente</h2>
            <form id="incomeForm">
                <div class="form-group">
                    <label for="incomeName">Nombre del ingreso:</label>
                    <input type="text" id="incomeName" required>
                </div>
                <div class="form-group">
                    <label for="incomeAmount">Monto:</label>
                    <input type="number" id="incomeAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="incomeFrequency">Frecuencia:</label>
                    <select id="incomeFrequency" required>
                        <option value="monthly">Mensual</option>
                        <option value="weekly">Semanal</option>
                        <option value="biweekly">Quincenal (cada 15 d√≠as)</option>
                        <option value="quarterly">Trimestral</option>
                        <option value="semiannual">Semestral</option>
                        <option value="annual">Anual</option>
                        <option value="custom">Personalizada</option>
                    </select>
                </div>
                <div class="form-group" id="incomeDateGroup">
                    <label for="incomeStartDate">Fecha de inicio:</label>
                    <input type="date" id="incomeStartDate" required>
                </div>
                <div class="form-group" id="incomeCustomFrequencyGroup" style="display: none;">
                    <label for="incomeCustomDays">Cada cu√°ntos d√≠as:</label>
                    <input type="number" id="incomeCustomDays" min="1" max="365" placeholder="Ej: 30">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Guardar</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('incomeModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Script principal -->
    <script src="script.js"></script>
    
    <!-- Script de carga y manejo de errores -->
    <script>
        // Verificar que la aplicaci√≥n se cargue correctamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ JM Budget cargado correctamente');
            
            // Verificar dependencias cr√≠ticas
            if (typeof Chart === 'undefined') {
                console.warn('‚ö†Ô∏è Chart.js no se carg√≥ correctamente');
                // Mostrar mensaje al usuario
                const warning = document.createElement('div');
                warning.style.cssText = 'position:fixed;top:20px;right:20px;background:#ff9500;color:white;padding:10px;border-radius:8px;z-index:10000;';
                warning.innerHTML = '‚ö†Ô∏è Algunas funciones pueden no estar disponibles';
                document.body.appendChild(warning);
                setTimeout(() => warning.remove(), 5000);
            }
            
            // Verificar localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                console.log('‚úÖ localStorage disponible');
            } catch (e) {
                console.error('‚ùå localStorage no disponible');
                alert('Error: localStorage no est√° disponible. La aplicaci√≥n no puede guardar datos.');
            }
            
            // Verificar conexi√≥n a internet para CDNs
            if (!navigator.onLine) {
                console.warn('‚ö†Ô∏è Sin conexi√≥n a internet - algunas funciones pueden no estar disponibles');
            }
        });
        
        // Manejo de errores globales
        window.addEventListener('error', function(e) {
            console.error('‚ùå Error en la aplicaci√≥n:', e.error);
        });
        
        // Manejo de errores de recursos no cargados
        window.addEventListener('load', function() {
            console.log('üì± Aplicaci√≥n lista para usar');
        });
    </script>
</body>
</html> 